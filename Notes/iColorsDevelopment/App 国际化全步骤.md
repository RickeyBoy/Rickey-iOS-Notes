# ç‹¬ç«‹å¼€å‘ä¹‹ App å›½é™…åŒ–å…¨æ­¥éª¤

> å…³äºæˆ‘ï¼šå¤§å‚æ‘¸é±¼ + ä¸šä½™ç‹¬ç«‹å¼€å‘ï¼Œä¹‹åä¼šè¾“å‡ºæ·±åº¦æŠ€æœ¯æ–‡ç«  + ç‹¬ç«‹å¼€å‘æŠ€å·§
>
> æˆ‘çš„å¾€æœŸæŠ€æœ¯æ–‡ç« åˆé›†ï¼š[RickeyBoy - Gitbub](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FRickeyBoy%2FRickey-iOS-Notes)
>
> æˆ‘çš„ç‹¬ç«‹å¼€å‘ Appï¼š[iColors - è®¾è®¡çµæ„Ÿ é…è‰²åŠ©æ‰‹](https://link.juejin.cn/?target=https%3A%2F%2Fapps.apple.com%2Fapp%2Fid6448422065)

å¯¹äºä¸€ä¸ªç‹¬ç«‹ app æ¥è®²ï¼Œå›½é™…åŒ–å‡ºæµ·æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ­¥éª¤ï¼Œæµ·å¤–å¹¿é˜”çš„å¸‚åœºå’Œè´­ä¹°åŠ›ï¼Œåœ¨è¥é”€è·Ÿä¸Šçš„æƒ…å†µä¸‹ï¼Œæ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„æ”¶å…¥æ¥æºã€‚

åœ¨åšå›½é™…åŒ–ä¹‹å‰ï¼Œå…¶å®æˆ‘åœ¨ç½‘ç»œä¸Šä¹Ÿæ‰¾è¿‡å¾ˆå¤šçš„èµ„æ–™å’Œæ•™ç¨‹ï¼Œä¸è¿‡ç»å¤§éƒ¨åˆ†æ•™ç¨‹åªæ˜¯è®²è§£äº†å…¶ä¸­çš„ä¸€ä¸ªæ­¥éª¤ï¼Œæ¯”å¦‚é€šè¿‡ localizable æ–‡ä»¶å®ç°å¤šè¯­è¨€ã€‚ä½†æ˜¯è¿™äº›æ•™ç¨‹æ™®éåªé€‚åˆæ¶æ„æ¯”è¾ƒç®€å•çš„ appï¼Œæ¶‰åŠåˆ°å›ºå®šæ–‡æ¡ˆã€ä¸”æ–‡æ¡ˆæ•°é‡ä¸å¤šçš„æƒ…å†µï¼Œå¹¶ä¸”å®æ“æ€§æœ‰é™ã€‚

æ‰€ä»¥æœ¬ç³»åˆ—ä¼šä»¥æˆ‘è‡ªå·±çš„ç‹¬ç«‹ appï¼šã€ŒiColorsã€ ä¸ºä¾‹ï¼Œå…¨æ–¹ä½è®²è§£å…¶ä¸­æ¶‰åŠåˆ°çš„å„ä¸ªæ­¥éª¤çš„åŸç†å’Œæ–¹æ³•ï¼Œæ„Ÿå…´è¶£ or è§‰å¾—æœ‰ç”¨çš„æœ‹å‹å¯ä»¥ç‚¹èµæ”¶è—ã€‚è¦æ˜¯è§‰å¾—éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥å» App Store ä¸‹è½½ä¸€ä¸‹æˆ‘çš„ Appï¼Œç‚¹ä¸ªäº”æ˜Ÿå¥½è¯„å“ˆå“ˆï¼

å®é™…æ•ˆæœå›¾ç¤ºï¼š

| ä¸­æ–‡ç‰ˆ                                             | è‹±æ–‡ç‰ˆ                                             |
| -------------------------------------------------- | -------------------------------------------------- |
| ![](../../backups/iColorsLocalization/chIntro.png) | ![](../../backups/iColorsLocalization/enIntro.png) |



# ğŸŒ ä¸ºä»€ä¹ˆè¦åšå›½é™…åŒ–

åšä¹‹å‰å…ˆæƒ³æ¸…æ¥šä¸ºä»€ä¹ˆè¦åšã€‚

å¯¹äºä¸€äº›å¤§ app è€Œè¨€ï¼Œåšå›½é™…åŒ–è‚¯å®šæ˜¯ä¸€ä»¶ç†æ‰€åº”å½“çš„äº‹æƒ…ã€‚é‚£ä¹ˆä½œä¸ºä¸€ä¸ªç‹¬ç«‹ app è€Œè¨€ä¸ºä»€ä¹ˆè¦åšå›½é™…åŒ–ï¼Ÿç®€å•è€Œè¨€ï¼Œé‚£å°±æ˜¯ç”¨æˆ·åŸºæ•°çš„æ‰©å¤§ï¼Œå†å åŠ æµ·å¤–ç”¨æˆ·çš„ä»˜è´¹èƒ½åŠ›æ›´å¼ºã€‚

### ç”¨æˆ·åŸºæ•°æˆè§„æ¨¡çš„æ‰©å¤§

è¿™ä¸€ç‚¹æ˜¯éå¸¸å®¹æ˜“å®¹æ˜“ç†è§£ï¼Œæ¯•ç«Ÿå…¨çƒç”¨æˆ·ä¼šæ›´å¤šã€‚å…¶å®å³ä¾¿æ²¡æœ‰åšå›½é™…åŒ–å¤šè¯­è¨€é€‚é…ï¼ŒApp ä¹Ÿæ˜¯å¯ä»¥ä¸Šæ¶æ‰€æœ‰å›½å®¶çš„ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸¤æ–¹é¢çš„é—®é¢˜ï¼š

1. App åœ¨æ‰€æœ‰å›½å®¶åªèƒ½æ‹¥æœ‰é»˜è®¤è¯­è¨€ç‰ˆæœ¬ï¼ˆæ¯”å¦‚ä¸­æ–‡ï¼‰çš„ AppStore ä»‹ç»é¡µï¼Œä»¥åŠ AppStore æœç´¢å…³é”®è¯ã€‚é‚£ä¹ˆå¯ä»¥æƒ³è±¡ï¼Œè‡ªç„¶æµé‡å°±å‡ ä¹ä¸å­˜åœ¨äº†ã€‚
2. å¦‚æœæ²¡æœ‰å®ç°å¯¹åº”è¯­è¨€ï¼Œæˆ–è€…æ²¡æœ‰è‹±è¯­çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¾ˆå®¹æ˜“é‡åˆ°ä¸‹è½½äº†å´æ— æ³•ä½¿ç”¨çš„æƒ…å†µã€‚è¿™æ ·å¾ˆå®¹æ˜“å¯¼è‡´åœ¨ AppStore æµ·å¤–å¸‚åœºè¢«æ‰“ä½åˆ†ã€‚

### æµ·å¤–ç”¨æˆ·çš„ä»˜è´¹èƒ½åŠ›

è¿™æ˜¯è€ç”Ÿå¸¸è°ˆçš„ä¸€ç‚¹ï¼Œæ•´ä½“è€Œè¨€æµ·å¤–ç”¨æˆ·çš„ä»˜è´¹èƒ½åŠ›å’Œä»˜è´¹æ„æ„¿éƒ½ä¼šæ¯”å›½å†…æ›´å¼ºã€‚æµ·å¤–ç”¨æˆ·å·²ç»ä¹ æƒ¯äº†ä¸ºå–œçˆ±çš„ app æˆ–è€…æ˜¯å·¥å…·ä»˜è´¹ï¼Œå¦‚æœè¶³å¤Ÿå–œæ¬¢æ˜¯å¾ˆæ„¿æ„ä»˜é«˜ä»·çš„ã€‚å¹¶ä¸”ç”±äºæ±‡ç‡ç­‰ä¸€äº›åŸå› ï¼Œå›½å†…è½¯ä»¶çš„ä»·æ ¼å¯¹äºæµ·å¤–ç”¨æˆ·è€Œè¨€æ˜¯ç›¸å¯¹åˆ’ç®—çš„ä¸€ç¬”é’±ã€‚æ‰€ä»¥å¯æƒ³è€ŒçŸ¥ï¼Œå•ä¸ªç”¨æˆ·çš„ä»·å€¼æ˜¯ä¼šç›¸å¯¹æ›´é«˜ä¸€ç‚¹çš„ã€‚

æ‰€ä»¥éå¸¸æ˜æ˜¾ï¼Œå³ä¾¿åšå›½é™…åŒ–éœ€è¦è¾ƒä¸ºå¤æ‚çš„å·¥ä½œé‡ï¼Œä¹Ÿæ˜¯å€¼å¾—åšçš„ï¼Œå°¤å…¶æ˜¯å¯¹äºç‹¬ç«‹ app è€Œè¨€æ›´æ˜¯å¦‚æ­¤ã€‚



# ğŸ“ å¼€å§‹å‰çš„å‡†å¤‡

å¥½çš„ï¼Œå†å†³å®šäº†è¦åšå›½é™…åŒ–é€‚é…å¤šè¯­è¨€ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æ­£å¼å¼€å§‹è¿™éƒ¨åˆ†çš„å®æ“äº†ã€‚è¿™é‡Œå…ˆç®€å•è¯´ä¸€ä¸‹æˆ‘è‡ªå·±çš„é¡¹ç›®æŠ€æœ¯æ ˆï¼š

- ä»£ç è¯­è¨€ï¼šSwiftUI
- æ•°æ®å­˜å‚¨ï¼šCore Data

- App åˆå§‹è¯­è¨€ï¼šä¸­æ–‡

- App ç›®æ ‡è¯­è¨€ï¼šè‹±æ–‡

è¿™é‡Œå†å¤šè¯´ä¸€å¥ï¼Œä¸€æ–¹é¢æˆ‘ç›®å‰çš„ç‹¬ç«‹ App åŠŸèƒ½ç®—æ˜¯éå¸¸å®Œå–„äº†ï¼›åŒæ—¶å› ä¸ºæˆ‘è¿™é‡Œæ¶‰åŠåˆ°äº† Core Data ä½œä¸ºæ•°æ®å­˜å‚¨ä¸­å¿ƒä¹‹ä¸€ï¼Œéœ€è¦è€ƒè™‘ Core Data æ¨¡å‹å‡çº§ï¼Œå¯¼è‡´æ•´ä¸ªè¿‡ç¨‹ä¼šæ›´åŠ å¤æ‚ã€‚

å¦‚æœä½ çš„ App åªæ˜¯ä¸€ä¸ªå°å‹å·¥å…·ï¼Œä¸æ¶‰åŠæ•°æ®æœ¬èº«çš„å¤šè¯­è¨€é€‚é…ï¼Œæˆ–è€… App æ–‡æ¡ˆå¤§å¤šæ•°æ˜¯é€šè¿‡å†™æ­»çš„æ–¹å¼å­˜åœ¨ï¼Œé‚£ä¹ˆåº”è¯¥ä¼šæ›´åŠ ç®€å•ä¸€äº›ã€‚

å¦å¤–ï¼Œè¿‡ç¨‹ä¸­ä¼šä½¿ç”¨åˆ° ChatGPTï¼ˆå…è´¹çš„å°±å¤Ÿäº†ï¼‰ï¼Œç›¸ä¿¡å¤§å®¶éƒ½å·²ç»æœ‰è´¦å·äº†å§ï¼æ•´ä¸ªè¿‡ç¨‹ä¸­æˆ‘æ„Ÿè§‰ç°åœ¨ AI å¯¹äºç”Ÿäº§åŠ›æ˜¯çœŸçš„æœ‰æ˜æ˜¾æå‡çš„ï¼Œä¹ æƒ¯ä½¿ç”¨çš„è¯ç¡®å®å¾ˆæœ‰å¸®åŠ©ã€‚æ¯•ç«Ÿç¨‹åºå‘˜ï¼Œå–„ç”¨å„ç§å·¥å…·æ˜¯åŸºæœ¬ç´ è´¨äº†ã€‚



# ğŸ«™ æ•°æ®åº“å†…å®¹ç¿»è¯‘

é¦–å…ˆæˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„æ•°æ®è¿›è¡Œç¿»è¯‘ã€‚å› ä¸ºæˆ‘çš„ App ã€ŒiColorsã€å†…éƒ¨æœ‰éå¸¸å¤šå†…å®¹æ•°æ®ï¼Œé€šè¿‡ Core Data è¿›è¡Œç®¡ç†ï¼Œè¿™äº›æ•°æ®éƒ½éœ€è¦è¿›è¡Œç¿»è¯‘ï¼Œè¿™ä¸€éƒ¨åˆ†çš„å·¥ä½œé‡å®é™…ä¸Šæ˜¯éå¸¸å¤§ï¼Œä»¥åŠéå¸¸å¤æ‚çš„ã€‚

## éš¾ç‚¹åˆ†æ

é¦–å…ˆæ¯”å¦‚åƒ App ä¸»æ‰“çš„ä¸­å›½ä¼ ç»Ÿè‰²ï¼Œå…¶å®æ¯ä¸€ç§é¢œè‰²éƒ½éœ€è¦ç¿»è¯‘å¯¹åº”çš„è‹±æ–‡åï¼Œè€Œä¸”ä¸ºäº†ä¿æŒè°ƒæ€§ï¼Œéœ€è¦éå¸¸é«˜è´¨é‡çš„ç¿»è¯‘ï¼Œå°½é‡è®©è‹±æ–‡åä¹Ÿèƒ½å°½é‡ä¿æŒä¼˜é›…ã€ç®€æ´ã€‚

æˆ‘æˆªå›¾ä¸¤ä¸ªé¡µé¢ä¸¾ä¾‹ï¼Œå¯ä»¥çœ‹åˆ°å…¶å®ä¸­å›½ä¼ ç»Ÿè‰²æœ¬èº«çš„åå­—å°±å¾ˆæœ‰è¯—æ„ï¼Œä¹Ÿæœ‰äº›ååƒ»ï¼›æœ€ç»ˆç¿»è¯‘å‡ºæ¥çš„ç»“æœä¹Ÿè¦èƒ½åšåˆ°åŒæ ·çš„æ•ˆæœã€‚

| ä¸­æ–‡ç‰ˆ                                                | è‹±æ–‡ç‰ˆ                                                |
| ----------------------------------------------------- | ----------------------------------------------------- |
| ![](../../backups/iColorsLocalization/chOneColor.png) | ![](../../backups/iColorsLocalization/enOneColor.png) |

å¦å¤–ï¼Œã€ŒiColorsã€æ•°æ®åº“æ•´ä½“éå¸¸çš„åºå¤§ï¼Œé™¤äº†å¤§é‡ä¸­å›½ä¼ ç»Ÿè‰²ä¹‹å¤–ï¼Œè¿˜æœ‰å¤§é‡çš„è‰²ç»„é…è‰²ï¼Œå…¨éƒ¨éƒ½éœ€è¦é«˜è´¨é‡çš„ç¿»è¯‘ã€‚

| ä¸­æ–‡ç‰ˆ                                               | è‹±æ–‡ç‰ˆ                                               |
| ---------------------------------------------------- | ---------------------------------------------------- |
| ![](../../backups/iColorsLocalization/chPalette.png) | ![](../../backups/iColorsLocalization/enPalette.png) |

æ‰€ä»¥è¿™ä¸€ä¸ªç« èŠ‚æˆ‘å°†ä¸“é—¨è®²ä¸€è®²æˆ‘å¦‚ä½•æŠŠè¿™äº›å†…å®¹ç¿»è¯‘å¥½ã€‚

éœ€è¦å†é¢å¤–è¯´æ˜çš„æ˜¯ï¼Œå¦‚æœä½ çš„ App ä¸æ¶‰åŠåˆ°ç‰¹åˆ«å¤šæœ¬åœŸåŒ–çš„å†…å®¹ï¼Œé‚£ä¹ˆå…¶å®å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ã€‚æ¯•ç«Ÿè¿™ä¸€æ­¥çš„å¤æ‚è¿‡ç¨‹ï¼Œæœ‰å› ä¸ºæˆ‘çš„ç‹¬ç«‹ App çš„ç‰¹æ®Šä¹‹å¤„ã€‚



## ç¬¬ä¸€æ­¥ï¼šæå–å¾…ç¿»è¯‘çš„æ–‡æ¡ˆ

é¦–å…ˆéœ€è¦ä»æ•°æ®åº“ä¸­ï¼Œå°†æ‰€æœ‰æ¶‰åŠåˆ°æ–‡æ¡ˆå…¨éƒ¨æ•´ç†å‡ºæ¥ã€‚è¿™ä¸€æ­¥ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿åç»­çš„ç¿»è¯‘ã€‚

æ¯”å¦‚æˆ‘çš„åŸå§‹æ•°æ®æ˜¯ä»¥ Json çš„æ–¹å¼å­˜åœ¨ï¼Œé€šè¿‡ Python è„šæœ¬å°±å¯ä»¥å°†å…¶ä¸­éœ€è¦ç¿»è¯‘çš„åå­—æå–å‡ºæ¥ï¼Œæ•´ç†æˆè¡¨æ ¼å½¢å¼ã€‚

å½“ç„¶ï¼Œå¦‚æœä½ ä¸ä¼šå†™çš„è¯ï¼Œä¹Ÿå¯ä»¥è®© ChatGPT å¸®ä½ å†™ä¸€ä¸ª Python è„šæœ¬ã€‚éœ€è¦æè¿°æ¸…æ¥šä½ çš„åŸå§‹æ•°æ®ç±»å‹ï¼Œä»¥åŠä½ çš„ç›®æ ‡å½¢å¼ï¼Œå¾ˆå¿«å°±å¯ä»¥æœ‰ä¸€ä¸ªéå¸¸å®Œç¾çš„è„šæœ¬äº†ã€‚

è¿™ä¸€æ­¥ç›¸å¯¹ç®€å•ï¼Œæˆ‘å°±ä¸è¿‡å¤šåºŸè¯äº†ã€‚



## ç¬¬äºŒæ­¥ï¼šç¿»è¯‘æ–‡æ¡ˆ

æ•´ç†å¥½äº†éœ€è¦ç¿»è¯‘çš„å†…å®¹ä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯å–‚ç»™ ChatGPTï¼Œç„¶ä»–å¸®å¿™ç¿»è¯‘äº†ã€‚å¦‚æœä½ æ˜¯å°Šè´µçš„ GPT-4 ç”¨æˆ·ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥å°†æ•´ä¸ªæ–‡ä»¶ç›´æ¥ä¸Šä¼ ï¼Œè¦ä¸ç„¶å°±åˆ†æ‰¹æ“ä½œä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ã€‚

åœ¨ prompt é˜¶æ®µï¼Œå¯ä»¥è¯´æ˜ä¸€äº›è¦æ±‚ï¼Œæ¯”å¦‚è¦æ±‚ç¿»è¯‘å "elegant"ã€"simple"ã€"poetic" ç­‰ã€‚

è™½è¯´ç¿»è¯‘å®Œæˆä¹‹åä»æ—§éœ€è¦äººå·¥å¯¹è¿™äº›ç¿»è¯‘è¿›è¡Œä¸€ä¸ªæ£€æŸ¥ï¼Œä¸è¿‡æœ‰äº† AI çš„å¸®åŠ©ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿè¿˜æ˜¯è½»æ¾å¾ˆå¤šäº†ã€‚



## ç¬¬ä¸‰æ­¥ï¼šå°† Core Data æ•°æ®å¯¹åº”çš„æ–‡æ¡ˆå¡å…¥

æ ¸å¿ƒå°±æ˜¯å°†ç¿»è¯‘åçš„è‹±æ–‡ï¼Œæ‹¼æ¥åˆ°å¯¹åº”çš„æ•°æ®ä¹‹ä¸­ï¼Œè¿™ä¸€æ­¥ä¹Ÿé€šè¿‡ Python è„šæœ¬å®ç°ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹

```python
import pandas as pd
import json

# è¯»å–ç¿»è¯‘æ–‡ä»¶
file_path = 'xxx.xlsx'
xls = pd.ExcelFile(file_path)

data_dict = {}
for sheet_name in xls.sheet_names:
    df = pd.read_excel(xls, sheet_name, header=None)
    # éå†æ‰€æœ‰è¡Œï¼Œå¹¶ä¸”æŠŠå…¶ä¸­è‹±æ–‡åˆ°å­—å…¸ä¸­
    for index, row in df.iterrows():
        key = row[0]  # Value from column 1
        value = row[1]  # Value from column 2
        data_dict[key] = value     
xls.close()

# æŒ‰ç…§ Json æ ¼å¼è¾“å‡º
output_file = 'xxx.json'
with open(output_file, 'w', encoding='utf-8') as f:
    json.dump(data_dict, f, ensure_ascii=False, indent=4)
```

ç”¨ä¸€å¼ å›¾æ¥è¯´æ˜å‰ä¸‰æ­¥åšçš„äº‹æƒ…ï¼š

![](../../backups/iColorsLocalization/translate_path.png)

è¿™é‡Œåªæ˜¯ä»¥ä¸­å›½ä¼ ç»Ÿè‰²æ¥è¿›è¡Œè¯´æ˜ï¼ˆå®é™…ä¸Šé™¤äº†ä¼ ç»Ÿè‰²è¿˜æœ‰å¤§é‡è‰²å½©ç»„åˆéœ€è¦å¤„ç†ï¼‰ï¼Œç¿»è¯‘ååœ¨åŸæœ‰çš„æ•°æ®ç»“æ„ä¸Šå¢åŠ äº†å¯¹åº”çš„è‹±æ–‡ç¿»è¯‘å†…å®¹ã€‚è¿™æ ·å°±å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥äº†ï¼Œå¯¹ Core Data åº•å±‚è¿›è¡Œå‡çº§ï¼Œä»è€Œåœ¨ App å†…è¯»å–åˆ°å¯¹åº”çš„ä¸­è‹±æ–‡åç§°ã€‚



# ğŸ§™ğŸ»â€â™€ï¸ Core Data æ¶æ„å‡çº§

æ•°æ®å†…å®¹å‡†å¤‡å¥½ä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯å‡çº§ Core Data æ¶æ„äº†ï¼Œç¡®ä¿èƒ½å¤Ÿé¡ºåˆ©çš„ä½¿ç”¨æœ€æ–°çš„æ•°æ®ã€‚è¿™é‡Œé¢æœ€ä¸»è¦çš„å°±æ˜¯ Core Data çš„æ¨¡å‹å‡çº§ï¼Œå› ä¸ºæ¯•ç«Ÿåœ¨åŸæœ‰æ¨¡å‹ä¸­æ–°å¢äº†è‹±æ–‡çš„åç§°ï¼ŒCore Data çš„æ¨¡å‹ä¹Ÿéœ€è¦åšå¯¹åº”çš„é€‚é…ï¼š

![CoreDataUpdate](../../backups/iColorsLocalization/CoreDataUpdate.png)

## ä»€ä¹ˆæ˜¯ schema migration

> æ•°æ®æ¨¡å‹æ€»æœ‰éœ€è¦å‡çº§çš„æ—¶å€™ï¼

æ‰€è°“ schema migrationï¼Œå…¶å®å°±æ˜¯æ•°æ®æ¨¡å‹å‡çº§ã€‚ä½¿ç”¨ Core Data æ¥ç®¡ç†æ•°æ®æ—¶ï¼Œè‚¯å®šæœ‰éœ€è¦å¯¹æ¨¡å‹è¿›è¡Œå‡çº§çš„æ—¶å€™ï¼Œæ¯”å¦‚ç»™æ¨¡å‹æ·»åŠ æ–°å±æ€§ã€åˆ é™¤å±æ€§ã€ä¿®æ”¹å±æ€§ç±»å‹ç­‰ç­‰ã€‚è€Œæˆ‘å°±ä»¥ç»™ Core Data æ¨¡å‹å¢åŠ å±æ€§ä¸ºä¾‹ï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„ï¼Œç»™ä¸­å›½ä¼ ç»Ÿè‰²æ¨¡å‹å¢åŠ è‹±æ–‡å±æ€§ï¼‰ï¼Œæ¥è®²è§£å½“æ•°æ®æ¨¡å‹å‘ç”Ÿè¿™äº›æ›´æ”¹ã€‚

é‚£ä¹ˆä¸ºä»€ä¹ˆè¦è¿›è¡Œæ•°æ®å‡çº§å‘¢ï¼Œå¦‚æœæˆ‘ç›´æ¥ç»™æ¨¡å‹åŠ ä¸€ä¸ªæ–°çš„å±æ€§ä¸å°±è¡Œäº†ä¹ˆï¼Ÿè¿™æ ·è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼ŒApp è‚¯å®šéœ€è¦æ¶‰åŠåˆ°å¯¹æ—§ç‰ˆæœ¬çš„å…¼å®¹ï¼Œæ—§ç‰ˆæœ¬å†…å®¹éœ€è¦æŒ‰ç…§ä¸€å®šçš„è§„åˆ™è¿‡æ¸¡åˆ°æ–°çš„å†…å®¹ã€‚

å…·ä½“è€Œè¨€ï¼Œå¦‚æœä¸è¿›è¡Œ schema migration å‡çº§æ“ä½œï¼š

- App è‚¯å®šæ— æ³•æ­£å¸¸è¿è¡Œï¼Œå­˜åœ¨æ•°æ®ä¸¢å¤±ã€æ•°æ®æŸåç­‰é—®é¢˜
- Core Data ä¼šç›´æ¥æ‹’ç»æ‰“å¼€ persistent storeï¼ŒæŠ¥é”™ `NSPersistentStoreIncompatibleVersionHashError`

æ¯”å¦‚ï¼Œå¦‚æœç›´æ¥æ”¹æ¨¡å‹ï¼Œå°±ä¼šæŠ¥é”™ï¼š

![CoreDataCrash](../../backups/iColorsLocalization/CoreDataCrash.png)



## ä½¿ç”¨ Lightweight migration

Apple å…¶å®å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§éå¸¸æ–¹ä¾¿ä¸”åˆç†çš„å‡çº§æ–¹å¼ï¼Œå°±æ˜¯ Lightweight migrationï¼Œå¦‚æœæƒ³è¦è¿›ä¸€æ­¥ç†è§£å®ƒï¼Œä»¥åŠå…¨æ–¹ä½ç†è§£ Core Data æ•°æ®ç»“æ„çš„å‡çº§ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ WWDC22 çš„æ•™å­¦è§†é¢‘ï¼š[WWDC22 - Evolve your Core Data schema](https://developer.apple.com/videos/play/wwdc2022/10120/)

ç²—ç•¥æ¥çœ‹ä»–çš„åŸç†çš„è¯ï¼Œå¯ä»¥ç”¨è§†é¢‘ä¸­çš„åŸæ–‡æ¥è¯´æ˜ï¼š

> Lightweight migration is the preferred method of migration. Lightweight migration automatically analyzes and infers the migration from the differences between the source and destination managed object models.
>
> At runtime, Core Data looks for the models in the bundles returned by .allBundles and .allFrameworks methods of the NSBundle class. Lightweight migration then generates a mapping model to materialize the changes you've made in your app in your database schema.
>
> -- Evolve your Core Data schema

Lightweight migration æ˜¯é¦–é€‰çš„æ•°æ®è¿ç§»æ–¹å¼ï¼Œå®ƒèƒ½å¤Ÿè‡ªåŠ¨æ¨æ–­å‡ºæºæ¨¡å‹å’Œç›®æ ‡æ¨¡å‹å·®åˆ«ã€‚åœ¨è¿è¡Œæ—¶ï¼ŒCore Data ä¼šé€šè¿‡ NSBundle.allBundlesã€NSBundle.allFrameworks ä¸­è·å–åˆ°æ‰€æœ‰çš„æ¨¡å‹ä¿¡æ¯ï¼Œç„¶å Lightweight migration æœºåˆ¶ä¼šè‡ªåŠ¨æ ¹æ®è¿™äº›æ¨¡å‹ï¼Œä»¥åŠä»–ä»¬ä¹‹é—´çš„æ˜ å°„å…³ç³»ç­‰ï¼Œæ¥æ”¹å˜æ•°æ®åº“ä¸­çš„æºæ¨¡å‹ã€‚



## Lightweight migration æ”¯æŒçš„èƒ½åŠ›

å¦‚ä¸Šæ–‡æ‰€è¯´ï¼ŒLightweight migration èƒ½å¤Ÿè‡ªåŠ¨æ”¯æŒ Core Data Models å¤§éƒ¨åˆ†ç±»å‹çš„æ”¹å˜ï¼Œé‚£ä¹ˆåˆ°åº•åŒ…å«å¤šå°‘ç±»å‹å‘¢ï¼Ÿ

é¦–å…ˆæ˜¯é’ˆå¯¹ Attributes çš„èƒ½åŠ›ï¼š

| English                                                   | ä¸­æ–‡                                   |
| --------------------------------------------------------- | -------------------------------------- |
| Adding                                                    | æ–°å¢å±æ€§                               |
| Removing                                                  | ç§»é™¤å±æ€§                               |
| Non-optional becoming optional                            | é optional å˜ä¸º optional              |
| Optional becoming non-optional and defining default value | optional å˜ä¸ºé optionalï¼Œå¹¶æŒ‡å®šé»˜è®¤å€¼ |
| Renaming                                                  | é‡å‘½å                                 |

> æ³¨æ„ï¼šCore Data èƒ½è‡ªåŠ¨é€‚é…ç‰ˆæœ¬å˜åŠ¨ï¼Œå¦‚ V1->V2->V3 éƒ½æœ‰æ”¹åŠ¨ï¼Œä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥è‡ªåŠ¨é€‚é… v1->v3

å…¶æ¬¡æ˜¯å…³äº Relationships çš„èƒ½åŠ›ï¼š

| English             | ä¸­æ–‡         |
| ------------------- | ------------ |
| Adding              | æ–°å¢å…³ç³»     |
| Removing            | ç§»é™¤å…³ç³»     |
| Renaming            | é‡å‘½å       |
| Cardinality changes | æ•°é‡å…³ç³»æ”¹å˜ |

>  æ³¨æ„ï¼šCardinality changes æŒ‡çš„æ˜¯æ•°æ®åº“å…³ç³»ä¸­å¯¹åº”çš„æ•°é‡å˜åŒ–ï¼ŒåŒ…æ‹¬ 1 å¯¹ 1ï¼Œ1 å¯¹å¤šï¼Œå¤šå¯¹å¤šã€‚

æœ€åæ˜¯å…³äº Entities çš„èƒ½åŠ›ï¼š

| English                                       | ä¸­æ–‡                     |
| --------------------------------------------- | ------------------------ |
| Adding                                        | æ–°å¢å®ä½“                 |
| Removing                                      | ç§»é™¤å®ä½“                 |
| Renaming                                      | é‡å‘½å                   |
| Creating new parent or child entities         | åˆ›å»ºæ–°çš„çˆ¶æˆ–å­å®ä½“       |
| Moving attributes within the entity hierarchy | åœ¨å®ä½“å±‚æ¬¡ç»“æ„ä¸­ç§»åŠ¨å±æ€§ |
| Modifying the entity hierarchy                | ä¿®æ”¹å®ä½“å±‚æ¬¡ç»“æ„         |
| **Cannot merge entity hierarchies**           | **æ— æ³•åˆå¹¶å®ä½“å±‚æ¬¡ç»“æ„** |

> æ³¨æ„ï¼šLightweight migration å¹¶ä¸èƒ½è‡ªåŠ¨åˆå¹¶ entity çš„ç»“æ„ï¼



## å®æˆ˜æ“ä½œ

å¦‚æœä½ ä»”ç»†é˜…è¯»ç†è§£äº†ä¸Šé¢ Lightweight migration çš„å†…å®¹ï¼Œå°±çŸ¥é“å…¶å®ä»å®æ“ä¸Šé¢æ¥è®²ï¼Œä½ å¹¶ä¸éœ€è¦åšä»€ä¹ˆäº‹æƒ…ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ NSPersistentContainerï¼Œé‚£ä¹ˆ Core Data å°±èƒ½å¤Ÿè‡ªåŠ¨å®ç°è¿™äº›åŠŸèƒ½ã€‚åªéœ€è¦æˆ‘ä»¬å®šä¹‰æ¸…æ¥šå‡çº§ä¹‹åçš„æ¨¡å‹å°±è¡Œäº†ã€‚

é€‰ä¸­ **Editor** ç„¶åé€‰ä¸­ **Add Model Version**ï¼Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ `.xcdatamodel` æ–‡ä»¶ï¼Œè¿™æ ·å°±ç®—æˆåŠŸäº†

![CoreDataModels](../../backups/iColorsLocalization/CoreDataModels1.png)



è¿™æ ·å…¶å®å°±åˆ›å»ºäº†ç›®æ ‡æ¨¡å‹äº†ï¼Œä¸è¿‡å¯ä»¥çœ‹åˆ°é‚£ä¸ªç»¿è‰²çš„å°å‹¾å‹¾ âœ… ç°åœ¨è¿˜åœ¨æ—§ Model ä¸Šé¢ï¼Œä»£è¡¨ç°åœ¨ App è¿˜é»˜è®¤ä½¿ç”¨çš„æ˜¯æ—§çš„æ¨¡å‹ã€‚

ä¸è¿‡æ²¡å…³ç³»ï¼Œæˆ‘ä»¬å…ˆå°† Model 2 è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹ä¸ºæˆ‘ä»¬æˆ‘ä»¬å¸Œæœ›å‡çº§åˆ°çš„æ–°æ¨¡å‹å°±å¯ä»¥äº†ã€‚æ¯”å¦‚æˆ‘çš„ä¾‹å­ä¸­ï¼Œå°±æ˜¯æ–°å¢ä¸€ä¸ª nameEn çš„ Attributeï¼š

![CoreDataUpdate2](../../backups/iColorsLocalization/CoreDataUpdate2.png)

å¥½çš„ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å°† Model 2 è®¾ç½®ä¸ºé»˜è®¤ã€‚é€‰ä¸­ Model 2ï¼Œæ‰“å¼€å³ä¾§ Inspectors é¢æ¿ï¼Œç„¶åé€‰æ‹© Current Model Version å°±å¯ä»¥äº†ï¼š

![CoreDataUpdate3](../../backups/iColorsLocalization/CoreDataUpdate3.png)

å¯ä»¥çœ‹åˆ°ï¼Œç°åœ¨ç»¿è‰²çš„å°å‹¾å‹¾ âœ… è½¬ç§»åˆ° Model 2 ä¸Šé¢ï¼Œå°±å·²ç»æˆåŠŸäº†ï¼

![CoreDataModels](../../backups/iColorsLocalization/CoreDataModels2.png)



# ğŸ•µğŸ»â€â™‚ï¸ Core Data æ¨¡å‹è§£æå‡çº§

å½“ Core Data æ•°æ®æ¨¡å‹å‡çº§å®Œæ¯•ä¹‹åï¼Œå°±æ„å‘³ç€æˆ‘ä»¬çš„æ•°æ®å¯ä»¥è¢«é¡ºåˆ©çš„å¯¼å…¥åˆ° App ä¹‹ä¸­äº†ã€‚ä¸è¿‡è¿™è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬åœ¨ App ä¸­ä½¿ç”¨æ¨¡å‹çš„ç›¸å…³ä»£ç ï¼Œä¹Ÿè¦åšä¸€å®šçš„è°ƒæ•´ã€‚

## å¦‚ä½•æ‰‹åŠ¨è§£æ Core Data

ç›®å‰æˆ‘çš„ App ä¸­ä½¿ç”¨çš„æ˜¯æ‰‹åŠ¨è§£æ Core Data Model çš„æ¨¡å¼ã€‚è¿™æ ·è™½ç„¶éœ€è¦å¤šä¸€äº›é¢å¤–çš„ä»£ç ï¼Œä½†æ˜¯å¥½å¤„æ˜¯æ›´åŠ ç›´è§‚å¯æ§ï¼Œä¹Ÿå¯ä»¥å¢åŠ ä¸€äº›è®¡ç®—å±æ€§ç­‰ï¼Œæé«˜ä»£ç çš„æ˜“ç”¨æ€§å’Œå¯è¯»æ€§ã€‚

é‚£ä¹ˆå¦‚ä½•é‡‡ç”¨æ‰‹åŠ¨è§£æçš„æ–¹æ³•å‘¢ï¼Ÿ

1. æˆ‘ä»¬å…ˆé€‰ä¸­ Core Data çš„æ¨¡å‹ï¼ˆæˆ‘ä»¬çš„ä¾‹å­ä¸­å°±æ˜¯ Model 2 æ–‡ä»¶ï¼‰
2. é€‰ä¸­ Xcode çš„ Tab `Editor`ï¼Œç„¶å `Create NSManagedObject subclass`ï¼Œé€‰ä¸­å¯¹åº”çš„ Data Model è¿›è¡Œåˆ›å»º
3. Xcode ä¼šè‡ªåŠ¨ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«ä¸º `xxxModel+CoreDataClass` å’Œ `xxxModel+CoreDataProperties`
4. æ³¨æ„ï¼Œæ­¤æ—¶ Data Model å¯¹åº”çš„ä»£ç ç”Ÿæˆæ–¹å¼ï¼ˆInspectors é¢æ¿ä¸­çš„ Codegenï¼‰ï¼Œåº”è¯¥é€‰æ‹© Manualï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º

![DataModel1](../../backups/iColorsLocalization/DataModel1.png)

æ­¤æ—¶ï¼ŒCore Data å°±æ˜ç™½äº†ï¼ŒApp åœ¨è§£ææ¨¡å‹æ—¶ï¼Œä¼šä½¿ç”¨æˆ‘ä»¬æ‰‹åŠ¨ç”Ÿæˆå’Œä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ `xxxModel+CoreDataClass` å’Œ `xxxModel+CoreDataProperties` è¿™ä¸¤ä¸ªã€‚

é‚£ä¹ˆï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶åº”è¯¥å¦‚ä½•å»å®ç°å‘¢ï¼Ÿå…¶å®ä¸»è¦æ˜¯ `xxxModel+CoreDataClass` æ–‡ä»¶ï¼Œæ˜¯éœ€è¦å£°æ˜å±æ€§çš„ã€‚è€Œ`xxxModel+CoreDataProperties` é€šå¸¸ä¸Šä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„éƒ¨åˆ†åŸºæœ¬å°±å¤Ÿäº†ã€‚

 æˆ‘è¿™é‡Œç›´æ¥ä¸Šä»£ç ï¼Œé¦–å…ˆæ˜¯ `xxxModel+CoreDataClass`ï¼ˆå…¶å®å°±æ˜¯ `ColorModel+CoreDataClass`ï¼‰ï¼Œæ³¨é‡Šæˆ‘ç›´æ¥åŠ è½½ä»£ç ä¹‹ä¸­äº†ï¼Œç›¸ä¿¡å¤§å®¶åº”è¯¥èƒ½å¤Ÿçœ‹æ‡‚

```swift
import CoreData

public class ColorModel: NSManagedObject, Decodable {
  	// é€šè¿‡ enum å£°æ˜éœ€è¦è§£æçš„å±æ€§åç§°
    private enum CodingKeys: String, CodingKey { case name, hex }

    // åˆå§‹åŒ–æ–¹æ³•ï¼Œç”¨äºè§£ç å’Œåˆå§‹åŒ–ColorModelå¯¹è±¡
    required convenience public init(from decoder: Decoder) throws {
        // è·å–ä¸Šä¸‹æ–‡å¯¹è±¡
        guard let context = decoder.userInfo[.context] as? NSManagedObjectContext else { fatalError("NSManagedObjectContext is missing") }
        // è·å–ColorModelå¯¹åº”çš„ entity
        guard let entity = NSEntityDescription.entity(forEntityName: "ColorModel", in: context) else { fatalError("Wrong entity name") }

        // åˆå§‹åŒ–
        self.init(entity: entity, insertInto: context)

        // è§£ç ï¼Œè·å–æ‰€æœ‰å‚æ•°ä¿¡æ¯ï¼Œå¹¶ä¾æ¬¡è§£æ
        let values = try decoder.container(keyedBy: CodingKeys.self)
        name = try values.decode(String.self, forKey: .name)
        hexString = try values.decode(String.self.self, forKey: .hex)
    }
}
```

è¿™æ®µä»£ç è§£æäº† ColorModelï¼Œå¯ä»¥çœ‹åˆ°ä»–æœ‰ä¸¤ä¸ªå±æ€§ï¼Œåˆ†åˆ«è§£æäº† name å’Œ hex ä¸¤ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°ã€‚



## æ‰‹åŠ¨è§£æ Core Dataï¼šé€‚é…æ›´æ–°åçš„æ¨¡å‹

ç›¸ä¿¡é€šè¿‡ä¸Šé¢çš„ä»£ç é€»è¾‘ï¼Œæˆ‘ä»¬ä¸éš¾çœ‹å‡ºï¼Œæ¨¡å‹å‡çº§åï¼Œå¯¹åº”çš„æ‰‹åŠ¨è§£ææ–‡ä»¶ä¹Ÿéœ€è¦ä¿®æ”¹ã€‚å½“ Model å‡çº§ä¸ºäº† Model 2 ä¹‹åï¼ŒColorModel é™¤äº† name å’Œ hexï¼Œè¿˜æ–°å¢äº†ä¸€ä¸ª nameEn çš„æ–°å±æ€§ã€‚

ä¸è¿‡æ˜ç™½äº†ä¸Šé¢çš„ä»£ç ä¹‹åï¼Œæ”¹åŠ¨èµ·æ¥å°±éå¸¸ç®€å•äº†ï¼Œåªéœ€è¦è°ƒæ•´ä¸¤ä¸ªåœ°æ–¹ï¼š

```swift
// ä¿®æ”¹ä¸€è¡Œ
private enum CodingKeys: String, CodingKey { case name, nameEn, hex }
// æ–°å¢ä¸€è¡Œ
nameEn = try values.decode(String.self, forKey: .nameEn)
```

ç›¸ä¿¡æˆ‘ä¸ç”¨åšå¤ªå¤šè¯´æ˜ï¼Œå¤§å®¶ä¹ŸçŸ¥é“è¯¥æ€ä¹ˆæ”¹äº†ã€‚ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨  `ColorModel+CoreDataProperties`  æ–‡ä»¶ä¸­ï¼Œå¢åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåšå¤šè¯­è¨€çš„é€‚é…ï¼š

```swift
func localizedName(_ locale: Locale) -> String {
      if locale.isEnglish { // è¿™é‡Œ isEnglish çš„åˆ¤æ–­å¦‚ä½•å®ç°ï¼Œæˆ‘åé¢ä¼šå†è¯¦ç»†è®²è§£
          return nameEn
      } else {
          return name
      }
  }
```



## Tipsï¼šå¦‚ä½•æŸ¥çœ‹ Core Data æ•°æ®

åœ¨å¯¹ Core Data è¿›è¡Œä¿®æ”¹çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸å…æ¶‰åŠåˆ°ä¸€äº›éœ€è¦è°ƒè¯•çš„æ—¶å€™ã€‚æ­¤æ—¶æˆ‘ä»¬å¦‚æœæœ‰ä¸€ä¸ªæ–¹æ³•èƒ½å¤Ÿç›´æ¥çœ‹åˆ° Core Data æ•°æ®åº“ä¸­çš„æ•°æ®æƒ…å†µå°±å¥½äº†ã€‚

å…³äºè¿™ä¸€ç‚¹ï¼Œå¯ä»¥åˆ†äº«ä¸€ä¸ªåœ¨ stack overflow ä¸Šé¢çœ‹åˆ°çš„ç¥å¥‡æ“ä½œï¼š[How can I check what is stored in my Core Data Database?](https://stackoverflow.com/a/49044302)



# ğŸ¤¿ æå– App å†…æ–‡æœ¬æ–‡æ¡ˆ

æˆ‘ä»¬å‰é¢èŠ±äº†å¤§éƒ¨åˆ†çš„ç¯‡å¹…ï¼Œè®²æ¸…æ¥šäº†å’Œ Core Data ç›¸å…³çš„æ•°æ®åº“æ–‡æ¡ˆçš„ç¿»è¯‘ã€‚ä¸€èˆ¬æ¥è®²ï¼ŒApp çš„å›½é™…åŒ–éœ€è¦è€ƒè™‘ä¸¤éƒ¨åˆ†æ–‡æ¡ˆï¼Œæˆ‘å§‘ä¸”ç§°ä¹‹ä¸ºâ€œæ•°æ®åº“æ–‡æ¡ˆâ€å’Œâ€œæ–‡æœ¬æ–‡æ¡ˆâ€ã€‚æ•°æ®åº“æ–‡æ¡ˆæ˜¯æŒ‡çš„ App ä¸­çš„è¿è¥å†…å®¹ï¼Œæ¯æ¬¡ä¸Šä¼ æ–°çš„è¿è¥æ•°æ®å…¶å®éƒ½ä¼šéœ€è¦å‡†å¤‡å¤šè¯­è¨€çš„ç‰ˆæœ¬ï¼Œæ˜¯ä¸€ä¸ªé•¿æœŸçš„æ´»ï¼›è€Œæ–‡æœ¬æ–‡æ¡ˆé€šå¸¸æœ¬èº«å°±æ˜¯å†™æ­»çš„ï¼Œåªéœ€è¦åœ¨å›½é™…åŒ–çš„æ—¶å€™ä¸€æ¬¡æ€§è§£å†³å°±è¡Œäº†ã€‚

ä¸‹é¢ç”¨ä¸€å¼ å›¾æ¥è¯´æ˜å°±å¾ˆæ¸…æ¥šäº†ï¼š

- çº¢è‰²éƒ¨åˆ†ï¼Œå°±æ˜¯æ–‡æœ¬æ–‡æ¡ˆ
- è“è‰²éƒ¨åˆ†ï¼Œå°±æ˜¯æ•°æ®åº“æ–‡æ¡ˆ

<img src="../../backups/iColorsLocalization/TranslateAppStrings.png" alt="TranslateAppStrings" style="zoom:30%;" />

å› ä¸ºæˆ‘çš„ App çš„ç‰¹æ®Šæ€§ï¼Œæ‰€ä»¥éœ€è¦å…ˆå¤„ç†æ•°æ®åº“æ–‡æ¡ˆï¼Œå®é™…ä¸Šå¤§éƒ¨åˆ† App åªéœ€è¦å¤„ç†æ–‡æœ¬æ–‡æ¡ˆå°±å¤Ÿäº†ã€‚è¿™ä¹Ÿæ˜¯ä¹‹å‰æˆ‘è¯´ï¼Œå¤§éƒ¨åˆ†ç½‘ä¸Šçš„å›½é™…åŒ–æ•™ç¨‹ï¼Œéƒ½ä¸èƒ½å¤Ÿç›´æ¥ä½¿ç”¨çš„åŸå› ã€‚

é‚£ä¹ˆï¼Œä»è¿™ä¸€ç« å¼€å§‹ï¼Œæˆ‘ä»¬å°±å‡†å¤‡å¼€å§‹å¤„ç†æ–‡æœ¬æ–‡æ¡ˆäº†ã€‚



## é…ç½®æ–°è¯­è¨€

æˆ‘ä»¬éœ€è¦å…ˆæ–°å¢ç›®æ ‡è¯­è¨€ï¼Œä»¥æˆ‘è¿™é‡Œçš„ä¾‹å­è€Œè¨€å°±æ˜¯æœ¬èº«æ”¯æŒä¸­æ–‡ï¼Œç°åœ¨éœ€è¦æ–°å¢è‹±æ–‡è¯­è¨€ã€‚è¿™éƒ¨åˆ†çš„æ•™ç¨‹å…¶å®å¾ˆå¤šï¼Œä¹Ÿå¹¶ä¸éš¾ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä¼šå°½é‡ç®€æ´åœ°è®²è§£ã€‚

é¦–å…ˆéœ€è¦æ ¹æ® `Project -> Info -> Localizations` åœ¨å·¥ç¨‹è®¾ç½®ä¸­æ·»åŠ æ‰€éœ€æœ¬åœ°åŒ–è¯­è¨€ï¼š

![TranslateAppStrings2](../../backups/iColorsLocalization/TranslateAppStrings2.png)

ä¹‹åå¦‚æœæœ‰ä¸€äº›ç¨å¾®æœ‰æ‰€ç»éªŒçš„å¼€å‘è€…ï¼Œå¯èƒ½çŸ¥é“æˆ‘ä»¬è¯¥åˆ›å»º `Localizable.strings` æ–‡ä»¶äº†ã€‚æ²¡é”™ï¼Œè¿™å…¶å®å°±æ˜¯æˆ‘ä»¬æœ€ç»ˆæƒ³è¦è·å¾—çš„ç¿»è¯‘æ–‡ä»¶ï¼Œåº”è¯¥æœ‰å¤šä»½ `Localizable.strings` æ–‡ä»¶æ¥æ‰¿è½½ä¸åŒçš„è¯­è¨€ç¿»è¯‘ã€‚

ä¸è¿‡ç›¸æ¯”äºä¼ ç»Ÿçš„ï¼Œæ‰‹åŠ¨åˆ›å»ºæ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œç¿»è¯‘ï¼Œæˆ‘ä»¬è¿™æ¬¡ä¼šå°è¯•ä½¿ç”¨æ›´å…·æ•ˆç‡çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯é€šè¿‡ Xcode çš„æ–°åŠŸèƒ½æ¥è‡ªåŠ¨è¿›è¡Œç”Ÿæˆã€‚



## Xcode è‡ªåŠ¨æå–æ–‡æœ¬æ–‡æ¡ˆ

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç¡®è®¤ Xcode ä¸­çš„ä¸€ä¸ªé…ç½®æ˜¯æ­£ç¡®çš„ï¼Œå³ `Use compiler to Extract Swift` è¿™ä¸ªé€‰é¡¹é…ç½®ä¸º YESã€‚è¿™é‡Œæ„å‘³ç€æˆ‘ä»¬å…è®¸ Xcode è‡ªåŠ¨æå–æˆ‘ä»¬ App ä¸­çš„æ–‡æœ¬æ–‡æ¡ˆï¼š

![TranslateAppStrings3](../../backups/iColorsLocalization/TranslateAppStrings3.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ Xcode çš„ Product é€‰ä¸­ Import Localizationsï¼Œå°±å¯ä»¥è‡ªåŠ¨åˆ›å»ºäº†ï¼š

![TranslateAppStrings4](../../backups/iColorsLocalization/TranslateAppStrings4.png)

æå–å‡ºæ¥ä¹‹åï¼Œå¤§æ¦‚é¡µé¢ä¼šæ˜¯è¿™æ ·ï¼š

![TranslateAppStrings5](../../backups/iColorsLocalization/TranslateAppStrings5.png)

è¿™é‡Œæœ‰ä¸¤åˆ— Englishï¼Œç¬¬äºŒåˆ—å’Œç¬¬ä¸‰åˆ—çœ‹èµ·æ¥ä¸€æ¨¡ä¸€æ ·ã€‚è¿™é‡Œè®²ä¸€ä¸‹åŒºåˆ«ï¼š

- ç¬¬äºŒåˆ—ï¼šä»£è¡¨åŸºç¡€è¯­è¨€ï¼ˆbase localizationï¼‰ï¼Œå¦‚æœä½ çš„ App é€‰æ‹©çš„ base language æ˜¯è‹±æ–‡ï¼Œé‚£ä¹ˆè¿™é‡Œå°±æ˜¯è‹±æ–‡ï¼Œå¦‚æœé€‰æ‹©çš„æ˜¯ä¸­æ–‡è¿™é‡Œå°±æ˜¯ä¸­æ–‡
- ç¬¬ä¸‰åˆ—ï¼šå½“å‰è¯­è¨€çš„ç¿»è¯‘ï¼Œç›®å‰æµè§ˆçš„æ˜¯è‹±æ–‡ç¿»è¯‘ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ˜¯è‹±æ–‡ï¼›å¦‚æœæµè§ˆçš„æ˜¯ä¸­æ–‡ç¿»è¯‘ï¼Œé‚£ä¹ˆç¬¬ä¸‰åˆ—å°±æ˜¯ä¸­æ–‡ã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°† Xcode è‡ªåŠ¨ç”Ÿæˆçš„ Localizable.strings å¯¼å…¥ï¼ŒæˆåŠŸä¹‹åçš„æ ·å¼åº”è¯¥æ˜¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![TranslateAppStrings6](../../backups/iColorsLocalization/TranslateAppStrings6.png)

è¿™æ ·ï¼Œæˆ‘ä»¬çš„æ¶æ„å®é™…ä¸Šå°±å·²ç»æˆåŠŸæ­å»ºèµ·æ¥äº†ï¼Œé€šè¿‡è¿™æ ·çš„æ–‡ä»¶æ¶æ„ï¼Œæˆ‘ä»¬å°±èƒ½å¤„ç†æ–‡æœ¬æ–‡æ¡ˆçš„å¤šè¯­è¨€å±•ç¤ºã€‚æ¯”å¦‚æˆ‘ä»¬åˆ†åˆ«åœ¨ Localizable.strings æ–‡ä»¶ä¸­å¢åŠ äº†å¯¹åº”çš„ç¿»è¯‘ï¼š

```swift
// Localizable (Chinese, Simplified)
"è‰²å½©ä¸»é¢˜" = "è‰²å½©ä¸»é¢˜";
// Localizable (English)
"è‰²å½©ä¸»é¢˜" = "Editor's Pick";
```

é‚£ä¹ˆåœ¨ä»£ç ä¸­å°±è‡ªåŠ¨è¢«æ›´æ–°äº†ï¼Œåœ¨è‹±æ–‡ç‰ˆä¸­ä¹Ÿå¯ä»¥è¢«ç›´æ¥æ­£å¸¸æ˜¾ç¤ºäº†ï¼

```Swift
Text("è‰²å½©ä¸»é¢˜")
```

æˆåŠŸï¼ä¸è¿‡ç›®å‰æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªå¤§é—®é¢˜æ²¡æœ‰è§£å†³ï¼š

å½“ App ä¸­çš„æ–‡æœ¬ä¸å¤šæ—¶ï¼Œç”¨è¿™æ ·çš„æ–¹å¼å¯ä»¥éå¸¸æ–¹ä¾¿çš„è¿›è¡Œåˆ›å»ºå’Œæå–ã€‚å¦‚æœ App æ¯”è¾ƒå¤æ‚ï¼Œé‡Œé¢æ¶‰åŠçš„æ–‡æœ¬éå¸¸å¤šï¼Œç”¨è¿™ç§è‡ªåŠ¨æå–çš„æ–¹æ³•ï¼Œå‘ç°æœ‰å¾ˆå¤šæ–‡æœ¬æ²¡æœ‰åŠæ³•è¢«è‡ªåŠ¨å¤„ç†ã€‚

ä¸è¿‡ä¸ç”¨æ‹…å¿ƒï¼Œé—æ¼çš„ç¿»è¯‘æˆ‘ä»¬æ˜¯æœ‰åŠæ³•æ£€æŸ¥å‡ºæ¥çš„ï¼Œç°åœ¨æˆ‘ä»¬åªéœ€è¦å…ˆè¿›è¡Œä¸‹ä¸€æ­¥ã€‚



# ğŸ“¡ æ›¿æ¢ä»£ç ä¸­ä½¿ç”¨çš„æ–‡æœ¬

å¥½çš„ï¼Œå‰æ–‡æˆ‘ä»¬æå–äº†ä¸€äº›å¾…ç¿»è¯‘çš„æ–‡ä»¶ï¼Œå…·ä½“ç¿»è¯‘çš„è¿‡ç¨‹æˆ‘ä»¬å°±è·³è¿‡äº†ã€‚ç°åœ¨å‡è®¾æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡æŸç§æ–¹å¼å¾—åˆ°å…·ä½“çš„ç¿»è¯‘åçš„ç»“æœã€‚é‚£ä¹ˆåœ¨æ­¤åŸºç¡€ä¹‹ä¸Šï¼Œæˆ‘ä»¬éœ€è¦å…ˆä¼˜åŒ–ä¸€ä¸‹ Localizable.strings çš„å£°æ˜æ–¹å¼ã€‚



## Localizable.strings ä½¿ç”¨ä¸“é—¨çš„ Key

ä¸Šä¸€éƒ¨åˆ†æˆ‘ä»¬åœ¨ Localizable.strings æ–‡ä»¶ä¸­å¢åŠ äº†å¯¹åº”çš„ç¿»è¯‘ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

```swift
// Localizable (Chinese, Simplified)
"è‰²å½©ä¸»é¢˜" = "è‰²å½©ä¸»é¢˜";
// Localizable (English)
"è‰²å½©ä¸»é¢˜" = "Editor's Pick";
```

ä½†æ˜¯è¿™æ ·æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œå°±æ˜¯å¯¹äºä¸­æ–‡ï¼ˆä¹‹å‰çš„é»˜è®¤è¯­è¨€ï¼‰æ¥è®²ï¼Œæ— æ³•åŒºåˆ†æ˜¯å¦æ˜¯å¤„ç†è¿‡çš„ç¿»è¯‘ã€‚æ¯”å¦‚æˆ‘ç°åœ¨åœ¨ä»£ç ä¸­æœ‰ä¸€ä¸ªç±»ä¼¼çš„ä½¿ç”¨ä¹‹å¤„ï¼Œæˆ‘å¹¶æ²¡æœ‰åŠæ³•ä¸€çœ¼è¯†åˆ«å‡ºï¼Œè¿™æ˜¯å¦æ˜¯ç»è¿‡å¤šè¯­è¨€å¤„ç†è¿‡çš„ã€‚

```swift
Text("é¦–é¡µ")
```

ä»¥åŠå¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æœ‰äº›æ—¶å€™ä¼šå­˜åœ¨åŒæ ·çš„ä¸­æ–‡ï¼Œå´å› ä¸ºå…·ä½“ä½¿ç”¨åœºæ™¯ä¸åŒï¼Œè€Œéœ€è¦å¯¹åº”ä¸åŒçš„è‹±æ–‡ã€‚æ¯”å¦‚åŒæ ·æ˜¯"ä¼šå‘˜"ï¼Œæœ‰äº›å¯èƒ½éœ€è¦æ ¹æ®ä½¿ç”¨åœºæ™¯ã€UI ç•Œé¢ç­‰ä¸åŒå› ç´ ï¼Œç¿»è¯‘æˆ "vip" æˆ–è€…æ˜¯ "membership"ã€‚è¿™æ ·å¦‚æœç›´æ¥ç”¨ä¸­æ–‡æœ¬èº«ä½œä¸º keyï¼Œå°±ä¼šäº§ç”Ÿé—®é¢˜ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬æœ€å¥½çš„æ–¹å¼è¿˜æ˜¯ä½¿ç”¨å•ç‹¬çš„ Keyï¼Œè¿™æ ·å¯ä»¥æ›´è§„èŒƒå’Œæ›´å‡†ç¡®ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š

```swift
// Localizable (Chinese, Simplified)
"SOME_KEY" = "è‰²å½©ä¸»é¢˜";
// Localizable (English)
"SOME_KEY" = "Editor's Pick";
```

è¿™æ ·ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å»æ›¿æ¢ä¸€ä¸‹ä½¿ç”¨å°±å¯ä»¥äº†ã€‚

```swift
Text("SOME_KEY")
```

è‡³äºè¿™é‡Œä½¿ç”¨çš„ KEYï¼Œåªéœ€è¦ä¿è¯å”¯ä¸€æ€§å°±å¯ä»¥äº†ï¼Œä¸æ­¤åŒæ—¶å¦‚æœèƒ½æœ‰ä¸€å®šçš„å­—é¢æ„ä¹‰ä¼šæ›´å¥½ã€‚å…·ä½“çš„ç”Ÿæˆå¯ä»¥äº¤ç»™ ChatGPTï¼Œèƒ½å¤ŸèŠ‚çº¦ä¸å°‘çš„æ—¶é—´ã€‚



## åœ¨ä»£ç ä¸­ä½¿ç”¨ Key

å¥½çš„ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æˆ‘è‡ªå·±è®¤ä¸ºæœ€çˆ½çš„æ—¶åˆ»äº†ï¼Œé‚£å°±æ˜¯æ›¿æ¢ä»£ç ä¸­æ–‡æœ¬æ–‡æ¡ˆçš„ä½¿ç”¨ã€‚é¦–å…ˆï¼Œå¦‚æœæ˜¯ Textã€Button ç­‰ç³»ç»Ÿæä¾›çš„ç»„ä»¶ï¼Œæ˜¯å¯ä»¥ç›´æ¥æ¥å— Key çš„ï¼š

```swift
// ç›´æ¥ä½¿ç”¨ key
Text("SOME_KEY")
Button("SOME_KEY", role: .cancel) { ... }
```

æˆ‘ä»¬æƒ³æƒ³ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œç›´æ¥ä½¿ç”¨ "SOME_KEY"ï¼Œå±•ç¤ºçš„æ˜¯å¤šè¯­è¨€ç»“æœï¼Œè€Œä¸æ˜¯ç›´æ¥å°† "SOME_KEY" ä½œä¸ºå­—ç¬¦ä¸²å±•ç¤ºå‡ºæ¥å‘¢ï¼Ÿ

> æ¥è‡ª SwiftUI æ–‡æ¡£çš„è§£é‡Šï¼š
>
> When you use the initializer `Text("Hello")`, SwiftUI creates a `LocalizedStringKey` for you and uses that to look up a localization of the `Hello` string. This works because `LocalizedStringKey` conforms to [`ExpressibleByStringLiteral`](doc://com.apple.documentation/documentation/swift/expressiblebystringliteral).

èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œæœ¬è´¨ä¸Šæ˜¯å› ä¸ºè¿™äº›ç»„ä»¶éƒ½é»˜è®¤å®ç°äº†é€šè¿‡ LocalizedStringKey ä½œä¸ºå‚æ•°è¿›è¡Œåˆå§‹åŒ–ï¼ŒSwiftUI ä¼šè‡ªåŠ¨é€šè¿‡ "SOME_KEY" åˆ›å»º LocalizedStringKey å®ç°å¤šè¯­è¨€ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ™®é€šçš„ Stringã€‚

```swift
extension Text {
    public init(_ key: LocalizedStringKey, tableName: String? = nil, bundle: Bundle? = nil, comment: StaticString? = nil)
}
```

æ²¡é”™ï¼Œè¿™é‡Œçš„ "SOME_KEY" ä¼šè¢«åˆ›å»ºä¸º LocalizedStringKey ç±»å‹ï¼Œè€Œä¸æ˜¯ String ç±»å‹ï¼

ç†è§£äº†è¿™ä¸€ç‚¹ï¼Œç›¸åº”çš„æˆ‘ä»¬å¦‚æœè‡ªå®šä¹‰ä¸€ä¸ª CustomViewï¼Œå°±éœ€è¦ä½¿ç”¨ LocalizedStringKey è€Œä¸æ˜¯ String

```swift
// å£°æ˜
struct CustomView: View {
    let title: LocalizedStringKey
  
    var body: some View {
        Text(title)
    }
}
```

å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨å°† String è½¬å˜ä¸º LocalizedStringKeyï¼Œæ¯”å¦‚åƒä¸‹é¢è¿™æ ·å£°æ˜

```swift
// å£°æ˜
struct CustomView: View {
    let some_key: String
  
    var body: some View {
        Text(LocalizedStringKey(some_key))
    }
}
```



## æ£€æŸ¥é—æ¼çš„ç¿»è¯‘

å¥½äº†ï¼Œå½“æˆ‘ä»¬æ›¿æ¢äº†æ‰€æœ‰å¤šè¯­è¨€çš„ä½¿ç”¨ä¹‹åï¼Œç°åœ¨æ¥è§£å†³ä¹‹å‰é—ç•™çš„ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœå‘ç°å¿˜è®°è¿›è¡Œå¤šè¯­è¨€çš„æ–‡æœ¬æ–‡æ¡ˆï¼Ÿ

æ­¤æ—¶æˆ‘ä»¬ç»Ÿä¸€ä½¿ç”¨ "SOME_KEY" çš„å¥½å¤„å°±ä½“ç°å‡ºæ¥äº†ï¼Œæˆ‘ä»¬åªéœ€è¦æ£€æŸ¥æ²¡æœ‰ç›´æ¥ä½¿ç”¨ä¸­æ–‡å­—ç¬¦ä¸²çš„åœ°æ–¹å³å¯ï¼Œå› ä¸ºæ­£ç¡®æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„ä»£ç ä¸­éƒ½ä¸ä¼šç›´æ¥å‡ºç°ä¸­æ–‡å­—ç¬¦ä¸²ï¼Œåªä¼šå‡ºç° "SOME_KEY"ï¼

ä¸‹é¢å°±æ˜¯æ£€æŸ¥è„šæœ¬ï¼Œå¦‚æœæœ‰é—æ¼çš„ç¿»è¯‘ï¼Œå°±ä¼šè¢«ç›´æ¥æ‰“å°å‡ºæ¥ã€‚åŸç†å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä¼šç”¨æ³¨é‡Šå°½é‡è®²æ¸…æ¥šï¼š

```python
import os
import unicodedata

project_directory = "xxxxx"

# åˆ¤æ–­å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«ä¸­æ–‡
def contains_chinese_characters(string):
    for char in string:
        if 'CJK' in unicodedata.name(char, ''):
            return True
    return False

# åˆ¤æ–­æ˜¯å¦æ˜¯æ³¨é‡Šå†…å®¹ï¼Œå¦‚æœæ˜¯æ³¨é‡Šå†…å®¹çš„è¯å¯ä»¥å¿½ç•¥
def is_comment(line):
    line = line.strip()
    return line.startswith("//") or line.startswith("/*") or ("//" in line and contains_chinese_characters(line.split("//")[1]))

# ç”¨äºç»Ÿè®¡ç»“æœ
violations = []

# éå†æ‰€æœ‰æ–‡ä»¶
for root, _, files in os.walk(project_directory):
    for file in files:
        if file.endswith(".swift"):
            file_path = os.path.join(root, file)
            with open(file_path, "r") as f:
                lines = f.readlines()
                for line_number, line in enumerate(lines, start=1):
                    # å¦‚æœä¸æ˜¯æ³¨é‡Šï¼Œä¸”åŒ…å«ä¸­æ–‡ï¼Œå°±è®°å½•ä¸‹æ¥
                    if not is_comment(line) and contains_chinese_characters(line):
                        violations.append((file_path, line_number, line.strip()))

# è¾“å‡º
if violations:
    print("Violations:")
    for violation in violations:
        file_path, line_number, line = violation
        print(f"File: {file_path}, Line: {line_number} - String: {line}")
else:
    print("No violations found.")
```

è¿™æ ·ï¼Œæˆ‘ä»¬é—æ¼çš„éƒ¨åˆ†å°±èƒ½è¢«è½»æ¾æ‰¾å‡ºæ¥äº†ã€‚æ¯”å¦‚ä¼šè¾“å‡ºï¼š

```python
File: /.../xxxx.swift, Line: 38 - String: AlertToast(type: .regular, title: "ä¿å­˜å¤±è´¥")
```

æŸ¥çœ‹å¯¹åº”çš„ä»£ç ï¼Œæ˜¯æˆ‘ç›´æ¥ä½¿ç”¨ç¬¬ä¸‰æ–¹ç»„ä»¶çš„éƒ¨åˆ†ï¼Œä¹‹å‰å°±æ²¡æœ‰è¢«è‡ªåŠ¨æå–å‡ºæ¥ï¼š

```swift
// å¼¹å‡ºå¤±è´¥æé†’
AlertToast(type: .regular, title: "ä¿å­˜å¤±è´¥")
```



## Tipsï¼šå…¨å±€æ›¿æ¢å¤šä½™çš„ LocalizedStringKey

æˆ‘ä»¬ä¹‹å‰æåˆ°ï¼ŒSwiftUI èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å‡º "SOME_KEY"ï¼Œå¹¶å¸®åŠ©æˆ‘ä»¬åˆ›å»º LocalizedStringKeyï¼Œä»è€Œå®ç°å¤šè¯­è¨€ã€‚ä¸éœ€è¦æ‰‹åŠ¨è¿›è¡Œé¢å¤–çš„åˆ›å»ºã€‚è¿™ä¸€ä¸ªä¼˜åŠ¿ä¸ä»…åŒ…æ‹¬ Textã€Buttonï¼Œä¹ŸåŒ…æ‹¬ navigationTitleã€toggle ç­‰ï¼Œä¹Ÿéƒ½æ˜¯å¯ä»¥è‡ªåŠ¨è¯†åˆ«çš„ã€‚

```swift
// æ²¡å¿…è¦
Text(LocalizedStringKey("SOME_KEY"))
// âœ…
Text("SOME_KEY")
```

è¿™æ ·å°±å¯ä»¥å¤§å¤§ç®€åŒ–æˆ‘ä»¬çš„ä»£ç ã€‚ä¸è¿‡å¯èƒ½æœ‰ä¸€äº›å¼€å‘è€…ï¼Œåœ¨æœ€å¼€å§‹å®ç°çš„æ—¶å€™å¹¶ä¸çŸ¥é“è¿™ä¸€ä¸ªæŠ€å·§ï¼Œæˆ–è€…ç°åœ¨è¯»äº†æ–‡ç« ä¹‹åæ‰çŸ¥é“è¿™ä¸ªæŠ€å·§ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Œéš¾é“è¦ä¸€ä¸ªä¸€ä¸ªåœ°æ–¹æ‰‹åŠ¨ä¿®æ”¹å—ï¼Ÿ

å½“ç„¶æˆ‘ä»¬è¿˜æœ‰æ›´å¥½çš„åŠæ³•ï¼Œå°±æ˜¯åˆ©ç”¨ Xcode çš„æ­£åˆ™åŒ¹é…æœç´¢ï¼Œæ¥è¿›è¡Œæ‰¹é‡çš„æ›¿æ¢ï¼

![TranslateAppStrings7](../../backups/iColorsLocalization/TranslateAppStrings7.png)

å¦‚å›¾æ‰€ç¤ºå°±å¯ä»¥äº†ï¼Œä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæˆ‘ç›´æ¥è´´åœ¨è¿™é‡Œï¼Œä¾›å¤§å®¶å‚è€ƒ

```swift
// Text(LocalizedStringKey("SOME_KEY"))
Text\(LocalizedStringKey\("(.+?)"\)\)
// Text("SOME_KEY")
Text\("$1"\)
```



# ğŸ¯ App å†…è¯­è¨€ç¯å¢ƒæ­å»º

å½“æˆ‘ä»¬åšå®Œä¸Šé¢çš„ä¸€åˆ‡æ“ä½œä¹‹åï¼ŒApp ç›®å‰çœ‹èµ·æ¥å·²ç»å¤§ä½“ä¸Šé€‚é…äº†å›½é™…åŒ–äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥çœ‹ä¸‹æ•ˆæœã€‚



## ä¿®æ”¹é»˜è®¤è¯­è¨€

ç›®å‰æˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æ¥è®¾ç½® App çš„é»˜è®¤è¯­è¨€ï¼Œæ¥æŸ¥çœ‹å¤šè¯­è¨€çš„æ•ˆæœã€‚å¯ä»¥åœ¨çœŸæœºçš„è®¾ç½®é¡µé¢ï¼Œè¿›è¡Œä¿®æ”¹ï¼š

<img src="../../backups/iColorsLocalization/LanguageSelection1.png" alt="LanguageSelection1" style="zoom:50%;" />

å½“ç„¶ï¼Œå¦‚æœæ˜¯é€šè¿‡ Xcode ç›´æ¥è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ Scheme ä¸­çš„ App Language è®¾ç½®ï¼Œæ¥é€‰æ‹©é»˜è®¤çš„è¯­è¨€ï¼š

![LanguageSelection1](../../backups/iColorsLocalization/LanguageSelection2.png)

å¦‚æœæ˜¯é€šè¿‡ SwiftUI Previewï¼Œå¯ä»¥è¿™æ ·å¿«é€Ÿæµ‹è¯•å¤šè¯­è¨€ï¼š

```swift
CustomView()
	.environment(\.locale, .init(identifier: "en")) // use English
	.environment(\.locale, .init(identifier: "zh-Hans")) // ä½¿ç”¨ä¸­æ–‡
```



## iOS ä¸­çš„è¯­è¨€ä½“ç³»

å†è¿›è¡Œæ¥ä¸‹æ¥çš„å†…å®¹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹ iOS ä¸­çš„è¯­è¨€ä½“ç³»ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ³¨æ„åˆ°æˆ‘ä»¬ä½¿ç”¨äº†è¯­è¨€ä»£ç  "zh-Hans" å’Œ "en" æŒ‡å®šå¯¹åº”çš„è¯­è¨€ï¼Œæ¥è°ƒæ•´ SwiftUI Preview ä¸­éœ€è¦å±•ç¤ºçš„è¯­è¨€ã€‚é‚£ä¹ˆè¿™é‡Œçš„ä»£ç åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

> [Locale - Apple](https://developer.apple.com/documentation/foundation/locale)
>
> Information about linguistic, cultural, and technological conventions for use in formatting data for presentation.

é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼ŒiOS ä¸­ä½¿ç”¨ Locale æ¥è®°å½•è¯­è¨€å’Œåœ°åŒºä¿¡æ¯ã€‚æ¯”å¦‚ Locale ä¸­ï¼Œæœ‰å‡ ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°å¯¹åº”çš„ä¿¡æ¯ï¼š

- [`language: Locale.Language`](https://developer.apple.com/documentation/foundation/locale/3952516-language)ï¼šè¯­è¨€ä¿¡æ¯ï¼Œä¸­æ–‡ã€è‹±è¯­ç­‰
- [`currency: Locale.Currency?`](https://developer.apple.com/documentation/foundation/locale/3952510-currency)ï¼šè´§å¸ä¿¡æ¯ï¼Œäººæ°‘å¸ã€ç¾å…ƒã€æ¬§å…ƒç­‰
- [`region: Locale.Region?`](https://developer.apple.com/documentation/foundation/locale/3952525-region)ï¼šåœ°åŒºï¼Œä¸­å›½å†…åœ°ï¼Œé¦™æ¸¯ï¼Œç¾å›½ç­‰

é‚£ä¹ˆå¦‚ä½•åˆå§‹åŒ–ä¸€ä¸ª Locale ç±»å‹å‘¢ï¼Ÿä¸€ç§æœ€ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯é€šè¿‡ identifier æ¥ç›´æ¥åˆ›å»ºï¼Œæ¯”å¦‚ "zh-Hans" å°±ä»£è¡¨ç®€ä½“ä¸­æ–‡ï¼Œè€Œ "en" å°±ä»£è¡¨è‹±æ–‡ï¼Œæ›´å¤šçš„è¿˜æœ‰ "fr" ä»£è¡¨æ³•è¯­ç­‰ç­‰ï¼Œè¯¦ç»†çš„å¯¹åº”å…³ç³»å¯ä»¥å‚è€ƒ [ioslocaleidentifiers - Github](https://gist.github.com/jacobbubu/1836273)



## æ”¯æŒ App å†…è¯­è¨€é€‰æ‹©

ç›®å‰è¯­è¨€é€‰æ‹©çš„é€»è¾‘æœ‰ä¸¤ä¸ªä¸»æµçš„æ–¹å¼ï¼Œä¸€ä¸ªæ˜¯ç›´æ¥åœ¨ App å†…æ”¯æŒè¯­è¨€é€‰é¡¹ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸æ”¯æŒ App å†…é€‰æ‹©è¯­è¨€ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨è®¾ç½®ä¸­é€‰ä¸­çš„è¯­è¨€ã€‚

å…¶å®ä¸¤ç§æ–¹å¼å¹¶æ²¡æœ‰éå¸¸æ˜æ˜¾çš„ä¼˜ç¼ºç‚¹ï¼Œæ”¯æŒ App å†…åˆ‡æ¢çš„è¯å¯èƒ½çµæ´»ä¸€ç‚¹ï¼Œä½†æ˜¯å®ç°èµ·æ¥ç›¸å¯¹éš¾ä¸€äº›ã€‚å¯ä»¥æ ¹æ®å…·ä½“ App è¯‰æ±‚è¿›è¡Œé€‰æ‹©ã€‚



æˆ‘è¿™é‡Œä¸»è¦è®²è§£ç¬¬ä¸€ç§ï¼Œå³æ”¯æŒè¯­è¨€åœ¨ App å†…è¿›è¡Œé€‰æ‹©ï¼Œæˆ‘çš„ App ä¹Ÿæ˜¯ç”¨çš„è¿™ç§æ–¹å¼ã€‚

<img src="../../backups/iColorsLocalization/LanguageSelection3.png" alt="LanguageSelection3" style="zoom:33%;" />

è¦å®ç°è¿™æ ·ä¸€ä¸ªè¯­è¨€é€‰æ‹©é€»è¾‘ï¼Œæˆ‘ä»¬è¦æ¥è‡ªå®šä¹‰ä¸€ä¸‹æ”¯æŒçš„è¯­è¨€ã€‚å°± iColors App æ¥è¯´ï¼Œç›®å‰å°±éœ€è¦æ”¯æŒä¸‰ç§è¯­è¨€ï¼Œä¸­æ–‡ + è‹±æ–‡ï¼Œä»¥åŠä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„è¯­è¨€ã€‚é‚£ä¹ˆé€šè¿‡æšä¸¾ç±»å‹ï¼Œè¿›è¡Œç±»ä¼¼äºä¸‹é¢çš„å®šä¹‰å³å¯ï¼š

> ä¸ºäº†æ–¹ä¾¿è¯»è€…ç†è§£ï¼Œè¿™é‡Œç½—åˆ—çš„ä»…æ˜¯æ‘˜è¦çš„ç®€å•ç‰ˆæœ¬ã€‚æƒ³è¦è¯¦ç»†ä½¿ç”¨çš„è¯ï¼Œå¯ä»¥å‚è€ƒï¼š[LanguageManager-SwiftUI - Github](https://github.com/Abedalkareem/LanguageManager-SwiftUI) ä¸­çš„ä»£ç 

```swift
public enum Languages: String {
    case en
    case zhHans = "zh-Hans"
    case deviceLanguage
}
```

æ³¨æ„ï¼Œè¿™é‡Œ Languages ç±»å‹çš„ rawValue å…¶å®å¯¹åº”çš„å°±æ˜¯å‰æ–‡æåˆ°çš„ Locale çš„è¯­è¨€ä»£ç ã€‚

ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å•ä¾‹ï¼Œè®°å½•å½“å‰é€‰æ‹©çš„è¯­è¨€å³å¯ï¼š

```swift
public class LanguageSettings: ObservableObject {
  @Published public var selectedLanguage: Languages = .deviceLanguage
}
```

å½“ç„¶æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªè½¬æ¢é€»è¾‘ï¼Œå°†æˆ‘ä»¬å®šä¹‰çš„ Languages æ¨¡å‹å’Œ iOS çš„ Locale æ¨¡å‹å…³è”èµ·æ¥ã€‚å½“æˆ‘ä»¬é€‰æ‹© .deviceLanguage æ—¶ï¼Œç›´æ¥ä½¿ç”¨å½“å‰é»˜è®¤çš„ Localeï¼Œå¦åˆ™ä½¿ç”¨æˆ‘ä»¬é€‰æ‹©çš„ languageï¼š

```swift
public class LanguageSettings: ObservableObject {
    @Published public var selectedLanguage: Languages = .deviceLanguage
  
    public var locale: Locale {
        if selectedLanguage == .deviceLanguage {
            return Locale.current
        } else {
            return Locale(identifier: selectedLanguage.rawValue)
        }
    }
}
```

è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªç®€å•çš„è¯­è¨€é€‰æ‹©é€»è¾‘ç³»ç»Ÿï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ App åˆå§‹åŒ–æ—¶å°† LanguageSettings çš„å•ä¾‹åˆå§‹åŒ–å¹¶é€šè¿‡ environment è¿›è¡Œç¯å¢ƒå˜é‡çš„å…³è”ï¼Œå¹¶ä¸”å°† locale ä¿¡æ¯è®¾ç½®ç»™æ•´ä¸ª App å³å¯ï¼Œè¿™æ ·æˆ‘ä»¬å…¨å±€çš„è¯­è¨€å°±å·²ç»è®¾ç½®å¥½äº†ã€‚

```swift
@main
struct XXXApp: App {
	@StateObject var settings = LanguageSettings()
  var body: some Scene {
        WindowGroup {
            ContentView()
                .environment(\.locale, settings.locale)
                .environmentObject(settings)
        }
    }
}
```



## å¢åŠ è¯­è¨€é€‰æ‹©é¡µé¢

æœ‰äº†ç›®å‰çš„è¯­è¨€ç®¡ç†æ¡†æ¶ï¼Œé‚£ä¹ˆå®ç°ä¸€ä¸ªè¯­è¨€é€‰æ‹©é¡µé¢ï¼Œå°±æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„é€»è¾‘äº†ã€‚æˆ‘ä»¬å¯ä»¥å¢åŠ ä¸€ä¸ªæ•°ç»„ï¼Œä¿å­˜æ”¯æŒçš„è¯­è¨€ï¼š

```swift
public class LanguageSettings: ObservableObject {
  ...
  public let supportedLanguages: [Languages] = [.zh, .en, .deviceLanguage]
}
```

ä¹‹åï¼Œåœ¨è¯­è¨€é€‰æ‹©é¡µé¢ï¼Œå±•ç¤ºæ‰€æœ‰æ”¯æŒçš„è¯­è¨€ï¼Œç„¶ååœ¨é€‰æ‹©åç»‘å®šåˆ°å½“å‰é€‰æ‹©çš„è¯­è¨€ `selectedLanguage` å³å¯ï¼š

```swift
struct MeLanguageSelection: View {
    @EnvironmentObject var languageSettings: LanguageSettings
    
    var body: some View {
        VStack {
            // list all choice
            ForEach(languageSettings.supportedLanguages, id: \.rawValue) { language in
                CustomChoiceView(language)
                    .onTapGesture {
                        // binding
                        languageSettings.selectedLanguage = language
                    }
            }
        }
    }
  
    ...
}
```



# ğŸ”¦ App å†…è¯­è¨€ç»†èŠ‚é€‚é…

æˆ‘ä»¬åšå®Œäº†å‰æ–‡æ‰€è¯´çš„ä¸€åˆ‡ï¼Œç›®å‰æ•´ä¸ª App åº”è¯¥ç»å¤§éƒ¨åˆ†å†…å®¹éƒ½å·²ç»é€‚é…å¤šè¯­è¨€äº†ã€‚å¤§çš„æ¡†æ¶å·²ç»å®Œæˆï¼Œå‰©ä½™çš„æ˜¯ä¸€äº›ç»†èŠ‚ä¼˜åŒ–ä¸è°ƒæ•´ï¼Œæœ‰éƒ¨åˆ†ç‰¹æ®Šçš„åœºæ™¯éœ€è¦é¢å¤–çš„è¿›è¡Œé€‚é…ã€‚



## ç³»ç»Ÿæƒé™æ–‡æ¡ˆçš„é€‚é…

<img src="../../backups/iColorsLocalization/LanguageSelection4.png" alt="LanguageSelection4" style="zoom:33%;" />

é™¤äº† App æœ¬èº«å†…å®¹æ”¯æŒå¤šè¯­è¨€ä¹‹å¤–ï¼Œç±»ä¼¼äºè¿™æ ·çš„æƒé™å†…å®¹ä¹Ÿéœ€è¦æ”¯æŒå¤šè¯­è¨€ã€‚é‚£æˆ‘ä»¬æ€ä¹ˆå»è®¾ç½®å‘¢ï¼Ÿå…¶å®åŸç†å’Œ Localizable.strings çš„åŸç†æ˜¯ä¸€è‡´çš„ï¼Œåªä¸è¿‡æ­¤æ—¶æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå«åš InfoPlist.stringsï¼Œç”¨æ¥ä¸“é—¨ä¸º InfoPlist ä¸­çš„å†…å®¹åšå¤šè¯­è¨€çš„é€‚é…ã€‚

![LanguageSelection5](../../backups/iColorsLocalization/LanguageSelection5.png)

æ”¯æŒç®€ä½“ä¸­æ–‡å’Œè‹±æ–‡çš„ï¼Œå®Œæ•´ Localizable æ–‡ä»¶åº”è¯¥å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ InfoPlist ä¸­çš„ key ä½œä¸ºkeyï¼ŒXcode ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åŒ¹é…å¯¹åº”çš„ç¿»è¯‘æ–‡æ¡ˆï¼Œå®ç°ä¸Šå›¾æ‰€ç¤ºå¤šè¯­è¨€æ•ˆæœã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ä¿å­˜å›¾ç‰‡çš„æƒé™ï¼Œè¿™ä¸ªæƒé™åœ¨ InfoPlist ä¸­å¯¹åº”çš„ key æ˜¯ NSPhotoLibraryAddUsageDescriptionï¼š

![LanguageSelection6](../../backups/iColorsLocalization/LanguageSelection6.png)

é‚£ä¹ˆæˆ‘ä»¬è¿›è¡Œå¦‚ä¸‹çš„é…ç½®ï¼Œå°±å¤§åŠŸå‘Šæˆäº†ï¼

```swift
// InfoPlist (Chinese, Simplified)
"NSPhotoLibraryAddUsageDescription" = "æˆ‘ä»¬éœ€è¦æ­¤æƒé™ç”¨äºä¿å­˜æ‚¨å–œæ¬¢çš„å†…å®¹";
// InfoPlist (English)
"NSPhotoLibraryAddUsageDescription" = "Allow photo library access to save your favorite color palettes";
```



## å°ç»„ä»¶æ–‡æ¡ˆé€‚é…

é™¤äº†ä¸» App æœ¬èº«çš„æ–‡æ¡ˆï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†æ˜¯å°ç»„ä»¶ä¸­ä½¿ç”¨çš„æ–‡æ¡ˆã€‚é€‚é…è¿™éƒ¨åˆ†çš„æ–‡æ¡ˆéå¸¸ç®€å•ï¼Œä¸éœ€è¦åšé¢å¤–çš„å¤„ç†ï¼ŒæŠŠç¿»è¯‘æ–‡æ¡ˆåŒæ ·æ”¾åˆ° Localizable.strings ä¸­å³å¯ã€‚

ä¸è¿‡è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œå°±æ˜¯å¦‚ä½•å°†ä¸» App ä¸­çš„è¯­è¨€é€‰æ‹©ï¼ŒåŒæ­¥åˆ° Widget å°ç»„ä»¶ä¸­ï¼Ÿæˆ‘é€‰ç”¨çš„æ˜¯é€šè¿‡ AppGroupUserDefaults çš„æ–¹æ¡ˆã€‚ç›¸ä¿¡ä¹‹å‰å®ç°äº†å°ç»„ä»¶åŠŸèƒ½çš„æƒ…å†µä¸‹ï¼Œå¤§æ¦‚ç‡å·²ç»å®ç°é€šè¿‡ AppGroup è¿›è¡Œæ•°æ®äº’é€šäº†ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†èµ˜è¿°å…·ä½“çš„å®ç°æ–¹æ³•ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¦‚æœåœ¨ App ä¸­é€‰æ‹©äº†æ–°è¯­è¨€ï¼Œæ›´æ”¹äº†è¯­è¨€ç¯å¢ƒä¹‹åéœ€è¦é€šçŸ¥å°ç»„ä»¶è¿›è¡Œåˆ·æ–°ï¼š

```swift
WidgetCenter.shared.reloadTimelines(ofKind: "CodeModulesWidget")
```



## è‡ªåŠ¨æ¢ç®—æ—¶é—´ä¿¡æ¯

å½“æˆ‘ä½¿ç”¨è„šæœ¬æ£€æŸ¥æœªç¿»è¯‘çš„å†…å®¹æ—¶ï¼Œå‘ç°æ¼ç½‘ä¹‹é±¼ï¼šåœ¨ iColors App ä¸­ï¼Œæœ‰éƒ¨åˆ†åœºæ™¯ä½¿ç”¨åˆ°äº†æ—¶é—´ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœˆä»½å’Œæ˜ŸæœŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![LanguageSelection7](../../backups/iColorsLocalization/LanguageSelection7.png)

è¿™éƒ¨åˆ†å†…å®¹å¦‚æœè¦æŒ‰ç…§ä¹‹å‰çš„æ–¹æ³•ï¼Œåœ¨ Localizable.strings ä¸­å®ç°å¯¹åº”çš„ç¿»è¯‘ä¹Ÿæ˜¯ä¸éš¾çš„ï¼Œä¸è¿‡ç¨æ˜¾ç¹çã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•å‘¢ï¼Ÿ

å…¶å® Locale æœ¬èº«å†…ç½®äº†æ ¹æ®å¤šè¯­è¨€ï¼Œè¿”å›å¯¹åº”æ—¥æœŸçš„æ–¹æ³•ï¼Œæˆ‘ä»¬è¿™é‡Œä»¥æœˆä»½ä¸ºä¾‹ï¼Œç”¨è¿™æ ·çš„æ–¹å¼å¯ä»¥è·å–åˆ°å½“å‰æœˆä»½çš„æ­£ç¡®è¡¨è¾¾ã€‚

```swift
func currentMonth(for locale: Locale) -> String {
    let calendar = Calendar.current
    let month = calendar.component(.month, from: self)

    let dateFormatter = DateFormatter()
    dateFormatter.locale = locale

    if let monthSymbols = dateFormatter.standaloneMonthSymbols {
        let monthSymbol = monthSymbols[month - 1]
        return monthSymbol
    } else {
        return ""
    }
}
```



# ğŸ¥³ ç»“è¯­

åˆ°è¿™é‡Œï¼Œæœ¬ç¯‡ç»ˆäºå®Œç»“äº†ã€‚ä¸€æ–¹é¢å®Œæˆå¦‚æ­¤å¤§å·¥ç¨‹çš„ä¸€ä¸ªé¡¹ç›®ï¼Œæˆ‘ä¹Ÿæƒ³å°½é‡å°†æˆ‘çš„æˆæœè®°å½•ä¸‹æ¥ï¼›å¦ä¸€æ–¹é¢ï¼Œä¹Ÿå¸Œæœ›è¿™äº›å†…å®¹èƒ½å¯¹è¯»è€…æœ‰æ‰€å¸®åŠ©ã€‚

æ„Ÿè°¢å¤§å®¶çš„é˜…è¯»ï¼Œå¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥ç»™æˆ‘ç•™è¨€ï¼Œæˆ‘ä¼šå°½é‡è§£ç­”ã€‚

